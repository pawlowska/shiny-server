---
title: "R Notebook"
output: html_notebook
---

Load stuff

```{r}
library(data.table)
source('ladowanie_danych.R', encoding = 'UTF-8')
source('obsluga_sumowania.R', encoding = 'UTF-8')
source('pogoda/imgw.R', encoding = 'UTF-8')
```

```{r}
plik_pogoda="pliki/IMGW_pogoda_20180531.csv"
```

```{r}
plik_pogoda_old="pliki/IMGW_pogoda_20180430.csv"
pogoda_old<-fread(plik_pogoda_old)
pogoda_old[,Data:=as.Date(Data)]
pogoda_new<-czytaj_dane_zipy(od=5, do=5, nazwa_out="pogoda/IMGW_2018_04.csv")
pogoda_new[,opad:=NULL]
pogoda_new[,rodzaj:=NULL]

pogoda<-unique(rbind(pogoda_old, pogoda_new))
write.csv(pogoda, file = plik_pogoda, fileEncoding = 'UTF-8', row.names = F)

```



```{r}
lokacje <- read.csv("pliki/polozenie_licznikow.csv",dec=",", encoding='UTF-8')
lokacje<-data.table(lokacje)
klucz <- lokacje[,c("id", "Miejsce")]

dane<-wczytaj_z_api(klucz=klucz, od="2014-08-13", do="2018-06-10")

```

```{r}
dane<-numery_dat(dane)
write.csv(dane, file = "dane/dane_polaczone.csv", fileEncoding = 'UTF-8')

dane_zsumowane<-suma_licznikow(dane)
rm(dane)
```

```{r}
nazwy<-names(dane_zsumowane)[4:length(names(dane_zsumowane))]
listy_stylow<-zrob_listy_stylow(nazwy, paleta=paleta20_sorted) #w obsluga_sumowania
write.csv(listy_stylow, file = "pliki/listy_stylow.csv", fileEncoding = 'UTF-8', row.names = F)
write.csv(dane_zsumowane, file = "dane/dane_polaczone_zsumowane.csv", fileEncoding = 'UTF-8')

```

```{r}
dane_zsumowane<-dodaj_pogode(dane_zsumowane, plik_pogoda)
print(str(dane_zsumowane))
write.csv(dane_zsumowane, file = "dane/dane_zsumowane_z_pogoda.csv", fileEncoding = 'UTF-8')
dane_long<-wide_to_long(dane_zsumowane)
rm(dane_zsumowane)
write.csv(dane_long, file = "pliki/dane_long.csv", fileEncoding = 'UTF-8')
```
